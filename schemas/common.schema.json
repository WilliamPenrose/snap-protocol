{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://snap-protocol.org/schemas/0.1/common.schema.json",
  "title": "SNAP Common Types",
  "description": "Shared type definitions used across SNAP Protocol schemas.",

  "$defs": {
    "P2TRAddress": {
      "title": "P2TR Address",
      "description": "Bitcoin Pay-to-Taproot address. 62 characters, bech32m encoded. Mainnet (bc1p) or testnet (tb1p).",
      "type": "string",
      "pattern": "^(bc1p|tb1p)[a-z0-9]{58}$",
      "examples": [
        "bc1p5d7rjq7g6rdk2yhzqnt9dp8wvscrplqk0zwy63lmgreu9jzyt0mqf3xvn8"
      ]
    },

    "MessageId": {
      "title": "Message ID",
      "description": "Unique message identifier. Must be unique per sender within 120 seconds. UUID v4 recommended.",
      "type": "string",
      "minLength": 1,
      "maxLength": 128,
      "pattern": "^[a-zA-Z0-9_-]+$",
      "examples": ["msg-001", "550e8400-e29b-41d4-a716-446655440000"]
    },

    "TaskId": {
      "title": "Task ID",
      "description": "Unique task identifier, generated by the agent (server).",
      "type": "string",
      "minLength": 1,
      "maxLength": 128,
      "pattern": "^[a-zA-Z0-9_-]+$",
      "examples": ["task-001"]
    },

    "ContextId": {
      "title": "Context ID",
      "description": "Groups related tasks into a conversation context.",
      "type": "string",
      "minLength": 1,
      "maxLength": 128,
      "pattern": "^[a-zA-Z0-9_-]+$",
      "examples": ["ctx-001"]
    },

    "ProtocolVersion": {
      "title": "Protocol Version",
      "description": "SNAP protocol version in MAJOR.MINOR format.",
      "type": "string",
      "pattern": "^\\d+\\.\\d+$",
      "examples": ["0.1"]
    },

    "SemVer": {
      "title": "Semantic Version",
      "description": "Semantic version string (MAJOR.MINOR.PATCH).",
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "examples": ["1.0.0"]
    },

    "UnixTimestamp": {
      "title": "Unix Timestamp",
      "description": "Unix timestamp in seconds (UTC). Integer, no fractional seconds.",
      "type": "integer",
      "minimum": 0,
      "examples": [1738627200]
    },

    "ISO8601Timestamp": {
      "title": "ISO 8601 Timestamp",
      "description": "ISO 8601 datetime string with timezone.",
      "type": "string",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(Z|[+-]\\d{2}:\\d{2})$",
      "examples": ["2025-02-04T10:00:00Z"]
    },

    "SchnorrSignature": {
      "title": "Schnorr Signature",
      "description": "64-byte Schnorr signature encoded as 128 lowercase hex characters.",
      "type": "string",
      "pattern": "^[0-9a-f]{128}$"
    },

    "SkillId": {
      "title": "Skill ID",
      "description": "Unique identifier for an agent skill. Lowercase alphanumeric with hyphens.",
      "type": "string",
      "minLength": 1,
      "maxLength": 64,
      "pattern": "^[a-z0-9-]+$",
      "examples": ["code-generation", "bug-fix"]
    },

    "SkillTag": {
      "title": "Skill Tag",
      "description": "Keyword tag for skill discovery. Lowercase alphanumeric with hyphens.",
      "type": "string",
      "minLength": 1,
      "maxLength": 32,
      "pattern": "^[a-z0-9-]+$",
      "examples": ["typescript", "react", "nodejs"]
    },

    "MethodName": {
      "title": "Method Name",
      "description": "SNAP method name in namespace/action format.",
      "type": "string",
      "minLength": 1,
      "maxLength": 64,
      "pattern": "^[a-z]+/[a-z_]+$",
      "examples": ["message/send", "tasks/get", "tasks/cancel"]
    },

    "MediaType": {
      "title": "Media Type",
      "description": "IANA media type (MIME type).",
      "type": "string",
      "maxLength": 128,
      "pattern": "^[a-z]+/[a-z0-9_.+-]+$",
      "examples": ["text/plain", "application/json", "image/png"]
    },

    "HttpsUrl": {
      "title": "HTTPS URL",
      "description": "Valid HTTPS URL.",
      "type": "string",
      "maxLength": 2048,
      "pattern": "^https://.+",
      "format": "uri"
    },

    "WssUrl": {
      "title": "WSS URL",
      "description": "Valid WebSocket Secure URL.",
      "type": "string",
      "maxLength": 2048,
      "pattern": "^wss://.+",
      "format": "uri"
    },

    "AgentEndpoint": {
      "title": "Agent Endpoint",
      "description": "A transport endpoint declared in the Agent Card. Caller tries endpoints in declared order.",
      "type": "object",
      "properties": {
        "protocol": {
          "title": "Transport Protocol",
          "description": "SNAP transport protocol type.",
          "type": "string",
          "enum": ["http", "wss"]
        },
        "url": {
          "title": "Endpoint URL",
          "description": "URL for this endpoint.",
          "type": "string",
          "maxLength": 2048,
          "format": "uri"
        }
      },
      "required": ["protocol", "url"],
      "additionalProperties": false
    },

    "NostrRelayUrl": {
      "title": "Nostr Relay URL",
      "description": "WebSocket URL of a Nostr relay server.",
      "type": "string",
      "maxLength": 2048,
      "pattern": "^wss://.+",
      "format": "uri"
    },

    "MessageType": {
      "title": "Message Type",
      "description": "Type of SNAP message.",
      "type": "string",
      "enum": ["request", "response", "event"]
    },

    "TaskState": {
      "title": "Task State",
      "description": "Current state of a task.",
      "type": "string",
      "enum": [
        "submitted",
        "working",
        "input_required",
        "completed",
        "failed",
        "canceled"
      ]
    }
  }
}
